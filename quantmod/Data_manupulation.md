## 2 基本数据操作：清洗、转换和抽取

任何数据分析过程都离不开数据操作，金融数据分析也不例外。这里就重点说一说quantmod包中与数据操作相关的一些函数及其用法。quantmod包中的函数大致可以归为这么几类：逻辑判断类、数据提取类、时期转换类、计算类、其它类。下面分类介绍一下这些函数，说明这些函数存在的原因以及具体用法。

### 2.1 逻辑判断函数

为什么要有逻辑判断类呢？因为quantmod包能处理的数据具有格式上的要求，即必须是OHLC、OHLCV、BBO、TBBO、HLC、quantmod、quantmodResults 中的一种，否则的话，函数没法进行正确的计算。这就要求我们在进行其它操作之前，得先判断我们读进来的数据是否属于上述数据中的一种。逻辑判断类的函数就是干这个活的。逻辑判断类的函数又能细分为两类，即 is 类和 has 类。

#### 2.1.1 is 族函数

is类函数用来判断数据是否属于某个特定类型。具体用法如下：

* is.OHLC(x):检查是否是OHLC类型数据
* is.OHLCV(x)：检查是否是OHLCV类型数据
* is.BBO(x)：检查是否是BBO类型数据
* is.TBBO(x)：检查是否是TBBO类型数据
* is.HLC(x):检查是否是HLC类型数据
* is.quantmod(x): 检查是否是quantmod对象
* is.quantmodResults(x):  检查是否是quatmodResults对象

举个例子。我们从网上获取 yahoo 公司的股票数据：

```{r}
> getSymbols("YHOO")
> YHOO["2013-10-01::"]
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2013-10-01     33.36     34.44    33.30      34.31    28153200         34.31
2013-10-02     34.15     34.70    33.90      34.14    21609200         34.14
2013-10-03     34.32     34.36    33.20      33.88    23252300         33.88
2013-10-04     33.96     35.06    33.96      34.89    23937800         34.89
2013-10-07     34.46     34.69    34.08      34.14    15432800         34.14
2013-10-08     34.46     34.50    32.10      32.93    42872200         32.93
2013-10-09     33.07     33.33    31.79      33.01    33491800         33.01
2013-10-10     33.49     33.91    33.33      33.87    23417200         33.87
2013-10-11     33.67     34.37    33.61      34.15    17006000         34.15
2013-10-14     33.80     34.10    33.68      34.00    17594900         34.00
2013-10-15     34.20     34.32    33.06      33.38    42360300         33.38
## 判断是否是OHLC对象
> is.OHLC(YHOO)
[1] TRUE
## 判断是否是OHLCV对象
> is.OHLCV(YHOO)
[1] TRUE
## 判断是否是HLC对象
> is.HLC(YHOO)
[1] TRUE
## 判断是否是BBO对象
> is.BBO(YHOO)
[1] FALSE
## 判断是否是quantmod对象
> is.quantmod(YHOO)
[1] FALSE FALSE
```

其它的用法类似，不再赘述。

#### 2.1.2 has 族函数

has 族函数用来判断数据中是否包含某个列或者字段。

* has.OHLC(x, which = FALSE) ：检查是否有open,high,low,close列或者字段
* has.HLC(x, which = FALSE)：检查是否有high,low,close列或者字段
* has.OHLCV(x, which = FALSE)：检查是否有open,high,low,close,volume列或者字段
* has.Op(x, which = FALSE)：检查是否有open列或者字段
* has.Hi(x, which = FALSE)：检查是否有high列或者字段
* has.Lo(x, which = FALSE)：检查是否有low列或者字段
* has.Cl(x, which = FALSE)：检查是否有close列或者字段
* has.Vo(x, which = FALSE)：检查是否有volume列或者字段
* has.Ad(x, which = FALSE)：检查是否有adjust列或者字段
* has.Ask(x, which = FALSE)：检查是否有ask列或者字段
* has.Bid(x, which = FALSE)：检查是否有bid列或者字段
* has.Price(x, which = FALSE)：检查是否有price列或者字段
* has.Qty(x, which = FALSE)：检查是否Qty列或者字段
* has.Trade(x, which = FALSE)：检查是否有trade列或者字段

```{r}
# 检查是否有open,high,low,close列或者字段
> has.OHLC(YHOO)
[1] TRUE TRUE TRUE TRUE
# 检查是否有high,low,close列或者字段
> has.HLC(YHOO)
[1] TRUE TRUE TRUE
# 检查是否有open,high,low,close,volume列或者字段
> has.OHLCV(YHOO)
[1] TRUE TRUE TRUE TRUE TRUE
```

其它类似，不予赘述。

### 2.2 数据提取

建模过程中要对数据进行各种转换和计算，而转换和计算的前提是能够先抽取目标数据。quantmod 提供了专门提取列数据和数据子集的函数。

#### 2.2.1 提取列数据

* Op(x):提取开盘价
* Hi(x):提取最高价
* Lo(x):提取最低价
* Cl(x):提取收盘价
* Vo(x):提取交易量
* Ad(x):提取调整价格
* HLC(x):提取最高价、最低价和收盘价
* OHLC(x):提取开盘价、最高价、最低价和收盘价

```{r}
## 提取开盘价
> Op(YHOO)
           YHOO.Open
2007-01-03     25.85
2007-01-04     25.64
2007-01-05     26.70
2007-01-08     27.70
2007-01-09     28.00
2007-01-10     27.48

## 提取最高价
> Hi(YHOO)
           YHOO.High
2007-01-03     26.26
2007-01-04     26.92
2007-01-05     27.87
2007-01-08     28.04
2007-01-09     28.05
2007-01-10     28.92

## 提取最低价
> Lo(YHOO)
           YHOO.Low
2007-01-03    25.26
2007-01-04    25.52
2007-01-05    26.66
2007-01-08    27.43
2007-01-09    27.41
2007-01-10    27.44

## 提取收盘价
> Cl(YHOO)
    YHOO.Close
2007-01-03      25.61
2007-01-04      26.85
2007-01-05      27.74
2007-01-08      27.92
2007-01-09      27.58
2007-01-10      28.70

## 提取成交量
> Vo(YHOO)
          YHOO.Volume
2007-01-03    26352700
2007-01-04    32512200
2007-01-05    64264600
2007-01-08    25713700
2007-01-09    25621500
2007-01-10    40240000

## 提取复权价格
> Ad(YHOO)
          YHOO.Adjusted
2007-01-03         25.61
2007-01-04         26.85
2007-01-05         27.74
2007-01-08         27.92
2007-01-09         27.58
2007-01-10         28.70

## 提取最高价、最低价和收盘价
> HLC(YHOO)
        YHOO.High YHOO.Low YHOO.Close
2007-01-03     26.26    25.26      25.61
2007-01-04     26.92    25.52      26.85
2007-01-05     27.87    26.66      27.74
2007-01-08     28.04    27.43      27.92
2007-01-09     28.05    27.41      27.58
2007-01-10     28.92    27.44      28.70

## 提取开盘价、最高价、最低价和收盘价
> OHLC(YHOO)
YHOO.Open YHOO.High YHOO.Low YHOO.Close
2007-01-03     25.85     26.26    25.26      25.61
2007-01-04     25.64     26.92    25.52      26.85
2007-01-05     26.70     27.87    26.66      27.74
2007-01-08     27.70     28.04    27.43      27.92
2007-01-09     28.00     28.05    27.41      27.58
2007-01-10     27.48     28.92    27.44      28.70
```

#### 2.2.2 提取子集

* first(x,k)：求前k个
* last(x,k):求后k个
* []

``` r
# 截取第一个数据
> first(YHOO)
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61

#截取前5个数据
> first(YHOO,5)
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61
2007-01-04     25.64     26.92    25.52      26.85    32512200         26.85
2007-01-05     26.70     27.87    26.66      27.74    64264600         27.74
2007-01-08     27.70     28.04    27.43      27.92    25713700         27.92
2007-01-09     28.00     28.05    27.41      27.58    25621500         27.58

# 截取前三周的数据
> first(YHOO,'3 weeks')
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61
2007-01-04     25.64     26.92    25.52      26.85    32512200         26.85
2007-01-05     26.70     27.87    26.66      27.74    64264600         27.74
2007-01-08     27.70     28.04    27.43      27.92    25713700         27.92
2007-01-09     28.00     28.05    27.41      27.58    25621500         27.58
2007-01-10     27.48     28.92    27.44      28.70    40240000         28.70
2007-01-11     28.76     29.37    28.70      29.20    28457500         29.20
2007-01-12     28.98     29.50    28.49      29.45    20971100         29.45
2007-01-16     29.88     29.88    28.79      29.29    24448400         29.29
2007-01-17     29.40     29.40    28.81      29.05    17796100         29.05
2007-01-18     28.92     28.99    27.82      28.12    23869400         28.12
2007-01-19     27.93     28.34    27.55      27.64    24757700         27.64

# 截取最后三周的头部数据
> head(last(YHOO,'-3 weeks'))
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61
2007-01-04     25.64     26.92    25.52      26.85    32512200         26.85
2007-01-05     26.70     27.87    26.66      27.74    64264600         27.74
2007-01-08     27.70     28.04    27.43      27.92    25713700         27.92
2007-01-09     28.00     28.05    27.41      27.58    25621500         27.58
2007-01-10     27.48     28.92    27.44      28.70    40240000         28.70

# 截取前两周中最后三天的数据
> last(first(YHOO, '2 weeks'), '3 days')
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-10     27.48     28.92    27.44      28.70    40240000         28.70
2007-01-11     28.76     29.37    28.70      29.20    28457500         29.20
2007-01-12     28.98     29.50    28.49      29.45    20971100         29.45

# 截取2007年的数据
> head(YHOO['2007'])
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61
2007-01-04     25.64     26.92    25.52      26.85    32512200         26.85
2007-01-05     26.70     27.87    26.66      27.74    64264600         27.74
2007-01-08     27.70     28.04    27.43      27.92    25713700         27.92
2007-01-09     28.00     28.05    27.41      27.58    25621500         27.58
2007-01-10     27.48     28.92    27.44      28.70    40240000         28.70

# 截取2009年的数据
> head(YHOO['2009'])
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2009-01-02     12.17     12.85    12.12      12.85     9514600         12.85
2009-01-05     12.72     13.01    12.39      12.86    11989900         12.86
2009-01-06     12.96     13.24    12.88      13.00    10056000         13.00
2009-01-07     12.71     13.16    12.45      12.71    24995900         12.71
2009-01-08     12.37     13.07    12.31      13.07    14355000         13.07
2009-01-09     13.42     13.56    12.90      13.13    19281000         13.13

# 截取2009年1月的数据
> head(YHOO['2009-01'])
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2009-01-02     12.17     12.85    12.12      12.85     9514600         12.85
2009-01-05     12.72     13.01    12.39      12.86    11989900         12.86
2009-01-06     12.96     13.24    12.88      13.00    10056000         13.00
2009-01-07     12.71     13.16    12.45      12.71    24995900         12.71
2009-01-08     12.37     13.07    12.31      13.07    14355000         13.07
2009-01-09     13.42     13.56    12.90      13.13    19281000         13.13

# 截取2009年1月至8月的数据
> head(YHOO['2009-01::2009-08'])
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2009-01-02     12.17     12.85    12.12      12.85     9514600         12.85
2009-01-05     12.72     13.01    12.39      12.86    11989900         12.86
2009-01-06     12.96     13.24    12.88      13.00    10056000         13.00
2009-01-07     12.71     13.16    12.45      12.71    24995900         12.71
2009-01-08     12.37     13.07    12.31      13.07    14355000         13.07
2009-01-09     13.42     13.56    12.90      13.13    19281000         13.13

# 2009年1月以来的数据
> head(YHOO['2009-01::'])
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2009-01-02     12.17     12.85    12.12      12.85     9514600         12.85
2009-01-05     12.72     13.01    12.39      12.86    11989900         12.86
2009-01-06     12.96     13.24    12.88      13.00    10056000         13.00
2009-01-07     12.71     13.16    12.45      12.71    24995900         12.71
2009-01-08     12.37     13.07    12.31      13.07    14355000         13.07
2009-01-09     13.42     13.56    12.90      13.13    19281000         13.13

```

### 2.3 数据转换

#### 2.3.1 滞后和提前算子

* Lag(x,k):求滞后k期
* Next(x, k = 1)：求k期

lag 函数的作用是将数据滞后 k 期。比如，下面的例子中，2007-01-03 的取值 25.85 被滞后一期到 2007-01-04。或者说，lag(Op(YHOO)) 对象中的 2007-01-04 对应的 是Op(YAHO) 的 2007-01-03 的对象。

``` r
> head(Op(YHOO))
           YHOO.Open
2007-01-03     25.85
2007-01-04     25.64
2007-01-05     26.70
2007-01-08     27.70
2007-01-09     28.00
2007-01-10     27.48

## 一阶滞后
> head(lag(Op(YHOO)))
           YHOO.Open
2007-01-03        NA
2007-01-04     25.85
2007-01-05     25.64
2007-01-08     26.70
2007-01-09     27.70
2007-01-10     28.00  

## 多阶滞后
> head(lag(Op(YHOO),c(1,3,5)))
           YHOO.Open YHOO.Open.1 YHOO.Open.2
2007-01-03        NA          NA          NA
2007-01-04     25.85          NA          NA
2007-01-05     25.64          NA          NA
2007-01-08     26.70       25.85          NA
2007-01-09     27.70       25.64          NA
2007-01-10     28.00       26.70       25.85
```

提前函数的作用于lag函数的作用刚好相反。看下面的例子：

``` r
## 提前函数
> Next(Op(YHOO))
            Next
2007-01-03 26.85
2007-01-04 27.74
2007-01-05 27.92
2007-01-08 27.58
2007-01-09 28.70
2007-01-10 29.20
```

#### 2.3.2 变动比率的计算

Delt 函数的作用是计算变化率或者变动比率。基本用法如下：

``` r
Delt(x1, x2 = NULL, k = 0, type = c("arithmetic", "log")) 
```

``` r
Stock.Open <- c(102.25,102.87,102.25,100.87,103.44,103.87,103.00)
Stock.Close <- c(102.12,102.62,100.12,103.00,103.87,103.12,105.12)

## 按开盘价计算收益率

> Delt(Stock.Open)
 Delt.1.arithmetic
[1,]                NA
[2,]       0.006063570
[3,]      -0.006027024
[4,]      -0.013496333
[5,]       0.025478338
[6,]       0.004156999
[7,]      -0.008375854
```

或者:

```
> Delt(Stock.Open,k=1)
   Delt.1.arithmetic
[1,]                NA
[2,]       0.006063570
[3,]      -0.006027024
[4,]      -0.013496333
[5,]       0.025478338
[6,]       0.004156999
[7,]      -0.008375854
```

等同于：

``` r
> diff(Stock.Open)/Stock.Open[1:6]
0.006063570 -0.006027024 -0.013496333  0.025478338  0.004156999 -0.008375854
```

也即是计算（T日收盘价-T-1日收盘价）/T-1日收盘价，对应的金融意义是算术收益率。当然，也可以计算几何收益率或者对数收益率，只需将 type 参数设定为 log 即可。

``` r
> Delt(Stock.Open,type='log')
      Delt.1.log
[1,]           NA
[2,]  0.006045260
[3,] -0.006045260
[4,] -0.013588236
[5,]  0.025159175
[6,]  0.004148383
[7,] -0.008411129
```

等同于：

``` r
> diff(log(Stock.Open))
[1]  0.006045260 -0.006045260 -0.013588236  0.025159175  0.004148383 -0.008411129
> 
```

除此之外还可以两列数据之间的变动比例。比如：

``` r
> Delt(Stock.Open,Stock.Close)
     Delt.0.arithmetic
[1,]      -0.001271394
[2,]      -0.002430252
[3,]      -0.020831296
[4,]       0.021116288
[5,]       0.004156999
[6,]      -0.007220564
[7,]       0.020582524
```

等同于:

``` r
> (Stock.Open-Stock.Close)/Stock.Open
[1]  0.001271394  0.002430252  0.020831296 -0.021116288 -0.004156999  0.007220564 -0.020582524
```

对应的经济学意义是股票收盘价相对于开盘价的变动幅度。

计算开盘价与下一期收盘价的差

``` r
> Delt(Stock.Open,Stock.Close,k=1)
     Delt.1.arithmetic
[1,]                NA
[2,]       0.003618582
[3,]      -0.026732770
[4,]       0.007334963
[5,]       0.029741251
[6,]      -0.003093581
[7,]       0.012034274
```

等同于：

``` r
> (Stock.Open[1:6]-Stock.Close[2:7])/Stock.Open[1:6]
[1] -0.003618582  0.026732770 -0.007334963 -0.029741251  0.003093581 -0.012034274
```

#### 2.3.3 列计算

* OpCl(x):等同于Delt(Op(x), Cl(x))
* ClCl(x):等同于Delt(Cl(x)),等价于diff(Cl(x))/lag(Cl(x))
* HiCl(x):等同于Delt(Hi(x),Cl(x))
* LoCl(x):等同于Delt(Lo(x),Cl(x))
* LoHi(x):等同于Delt(Lo(x),Hi(x))
* OpHi(x):等同于Delt(Op(x),Hi(x))
* OpLo(x):等同于Delt(OP(x),Lo(x))
* OpOp(x):等同于Delt(Op(x))

``` r
> head(YHOO)
          YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-03     25.85     26.26    25.26      25.61    26352700         25.61
2007-01-04     25.64     26.92    25.52      26.85    32512200         26.85
2007-01-05     26.70     27.87    26.66      27.74    64264600         27.74
2007-01-08     27.70     28.04    27.43      27.92    25713700         27.92
2007-01-09     28.00     28.05    27.41      27.58    25621500         27.58
2007-01-10     27.48     28.92    27.44      28.70    40240000         28.70

## 计算涨跌
> head(OpCl(YHOO))
              OpCl.YHOO
2007-01-03 -0.009284333
2007-01-04  0.047191888
2007-01-05  0.038951311
2007-01-08  0.007942238
2007-01-09 -0.015000000
2007-01-10  0.044395924

## 计算收益率
> head(ClCl(YHOO))
              ClCl.YHOO
2007-01-03           NA
2007-01-04  0.048418586
2007-01-05  0.033147114
2007-01-08  0.006488825
2007-01-09 -0.012177650
2007-01-10  0.040609137

## 计算收盘价对最高价的变动比率
> head(HiCl(YHOO))
              HiCl.YHOO
2007-01-03 -0.024752475
2007-01-04 -0.002600297
2007-01-05 -0.004664514
2007-01-08 -0.004279601
2007-01-09 -0.016755793
2007-01-10 -0.007607192

## 计算收盘价对最低价的变动比率
> head(LoCl(YHOO))
             LoCl.YHOO
2007-01-03 0.013855899
2007-01-04 0.052115987
2007-01-05 0.040510128
2007-01-08 0.017863653
2007-01-09 0.006202116
2007-01-10 0.045918367

## 计算振幅
> head(LoHi(YHOO))
            LoHi.YHOO
2007-01-03 0.03958828
2007-01-04 0.05485893
2007-01-05 0.04538635
2007-01-08 0.02223843
2007-01-09 0.02334914
2007-01-10 0.05393586

## 计算最高价对收盘价的变动比率
> head(OpHi(YHOO))
             OpHi.YHOO
2007-01-03 0.015860735
2007-01-04 0.049921997
2007-01-05 0.043820225
2007-01-08 0.012274368
2007-01-09 0.001785714
2007-01-10 0.052401747

## 计算最低价对开盘价的变动比率
> head(OpLo(YHOO))
              OpLo.YHOO
2007-01-03 -0.022823985
2007-01-04 -0.004680187
2007-01-05 -0.001498127
2007-01-08 -0.009747292
2007-01-09 -0.021071429
2007-01-10 -0.001455604

## 计算两日收盘价的变动比率
> head(OpOp(YHOO))
              OpOp.YHOO
2007-01-03           NA
2007-01-04 -0.008123791
2007-01-05  0.041341654
2007-01-08  0.037453184
2007-01-09  0.010830325
2007-01-10 -0.018571429
```

### 2.3.4 收益率计算

计算收益率的主要函数有：

* periodReturn():计算阶段收益率
* dailyReturn():计算日收益率
* weeklyReturn):计算周收益率
* monthlyReturn():计算月收益率
* quarterlyReturn():计算季度收益率
* annualReturn():计算年度收益率
* yearlyReturn():计算年收益率
* allReturns():计算各期收益率

举几个例子：

```{r}
#求日收益率
> periodReturn(YHOO,period='daily')
           daily.returns
2007-01-03  -0.009284333
2007-01-04   0.048418586
2007-01-05   0.033147114
2007-01-08   0.006488825
2007-01-09  -0.012177650
2007-01-10   0.04060913
```

或者

``` r
> dailyReturn(YHOO)
           daily.returns
2007-01-03  -0.009284333
2007-01-04   0.048418586
2007-01-05   0.033147114
2007-01-08   0.006488825
2007-01-09  -0.012177650
2007-01-10   0.040609137
```

```{r}
#求周收益率
> periodReturn(YHOO,period='weekly')
           weekly.returns
2007-01-05     0.07311412
2007-01-12     0.06164384
2007-01-19    -0.06146010
2007-01-26     0.01447178
2007-02-02     0.02603424
2007-02-09     0.03371568
```

或者

``` r
> weeklyReturn(YHOO)
           weekly.returns
2007-01-05     0.07311412
2007-01-12     0.06164384
2007-01-19    -0.06146010
2007-01-26     0.01447178
2007-02-02     0.02603424
2007-02-09     0.03371568

```

```{r}
#求月收益率
> periodReturn(YHOO,period='monthly')
           monthly.returns
2007-01-31      0.09516441
2007-02-28      0.09007418
2007-03-30      0.01393390
2007-04-30     -0.10386705
2007-05-31      0.02353780
2007-06-29     -0.05470383
```

或者

```{r}
> monthlyReturn(YHOO)
           monthly.returns
2007-01-31      0.09516441
2007-02-28      0.09007418
2007-03-30      0.01393390
2007-04-30     -0.10386705
2007-05-31      0.02353780
2007-06-29     -0.05470383
```

``` r
#求季度度收益率
> periodReturn(YHOO,period='quarterly')
           quarterly.returns
2007-03-30        0.21044487
2007-06-29       -0.13294982
2007-09-28       -0.01068927
2007-12-31       -0.13338301
2008-03-31        0.24376612
2008-06-30       -0.28586243
```

或者

``` r
> quarterlyReturn(YHOO)
           quarterly.returns
2007-03-30        0.21044487
2007-06-29       -0.13294982
2007-09-28       -0.01068927
2007-12-31       -0.13338301
2008-03-31        0.24376612
2008-06-30       -0.28586243

```
### 2.3.5 其它函数

### 2.5.5 日期转换函数

* to.weekly()：将OHLC数据转化为周数据
* to.monthly():将PHLC数据转化为月数据
* periodicity()：返回数据的日期范围

```{r}
#例子

> periodicity(YHOO)
Daily periodicity from 2007-01-03 to 2014-11-05 
> tail(to.weekly(YHOO))
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2014-10-03     40.41     41.69    39.69      41.03   164114200         41.03
2014-10-10     41.20     41.73    39.59      39.60   142869100         39.60
2014-10-17     39.52     40.07    36.20      38.45   170281500         38.45
2014-10-24     38.47     43.65    38.25      43.50   192528700         43.50
2014-10-31     43.31     46.52    43.29      46.05   133411900         46.05
2014-11-05     46.05     48.28    45.74      47.46    75105200         47.46

> tail(to.monthly(YHOO))
            YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume
六月 2014       34.69     37.06    33.02      35.13   350662000
七月 2014       35.50     36.99    32.93      35.81   518701600
八月 2014       35.69     38.72    35.15      38.51   293155100
九月 2014       38.90     44.01    37.90      40.75  1217558600
十月 2014       40.66     46.52    36.20      46.05   737008700
十一月 2014     46.05     48.28    45.74      47.46    75105200
            YHOO.Adjusted
六月 2014           35.13
七月 2014           35.81
八月 2014           38.51
九月 2014           40.75
十月 2014           46.05
十一月 2014         47.46

> endpoints(YHOO,on="months")
 [1]    0   20   39   61   81  103  124  145  168  187  210  231  251  272
[15]  292  312  334  355  376  398  419  440  463  482  504  524  543  565
[29]  586  606  628  650  671  692  714  734  756  775  794  817  838  858
[43]  880  901  923  944  965  986 1008 1028 1047 1070 1090 1111 1133 1153
[57] 1176 1197 1218 1239 1260 1280 1300 1322 1342 1364 1385 1406 1429 1448
[71] 1469 1490 1510 1531 1550 1570 1592 1614 1634 1656 1678 1698 1721 1741
[85] 1762 1783 1802 1823 1844 1865 1886 1908 1929 1950 1973 1976

> YHOO[endpoints(YHOO,on="months")]
           YHOO.Open YHOO.High YHOO.Low YHOO.Close YHOO.Volume YHOO.Adjusted
2007-01-31     28.04     28.48    27.82      28.31    14100300         28.31
2007-02-28     30.86     31.47    30.09      30.86    30487800         30.86
2007-03-30     31.21     31.60    31.02      31.29     9425000         31.29
2007-04-30     28.32     28.50    28.00      28.04    17596300         28.04
2007-05-31     28.76     28.85    28.49      28.70    15859100         28.70
2007-06-29     27.21     27.38    26.93      27.13    13842500         27.13
2007-07-31     23.88     23.93    23.24      23.25    21575800         23.25
2007-08-31     22.81     22.83    22.51      22.73    13052500         22.73
2007-09-28     26.49     26.89    26.20      26.84    22155600         26.84
2007-10-31     31.50     31.75    30.50      31.10    34762000         31.10
2007-11-30     26.96     27.33    26.51      26.81    23994000         26.81
2007-12-31     23.22     23.43    23.11      23.26    14782600         23.26
2008-01-31     18.87     19.35    18.72      19.18    41449800         19.18
2008-02-29     27.94     28.41    27.50      27.78    23860500         27.78
2008-03-31     28.56     29.12    28.27      28.93    17224600         28.93
2008-04-30     27.17     27.78    26.76      27.41    31034100         27.41
2008-05-30     27.07     27.10    26.63      26.76    17771800         26.76
2008-06-30     21.12     21.20    20.60      20.66    17173500         20.66
2008-07-31     19.89     20.15    19.85      19.89    16621100         19.89
2008-08-29     19.54     19.60    19.28      19.38    11204900         19.38
2008-09-30     17.15     17.62    17.00      17.30    23672300         17.30
2008-10-31     13.09     13.36    12.71      12.82    24017600         12.82
2008-11-28     10.76     11.59    10.65      11.51    12397600         11.51
2008-12-31     11.95     12.30    11.92      12.20     9085500         12.20
2009-01-30     11.86     12.15    11.51      11.73    21508900         11.73
2009-02-27     12.66     13.33    12.61      13.23    20392600         13.23
2009-03-31     12.76     13.10    12.67      12.81    12066000         12.81
2009-04-30     14.12     14.60    14.12      14.29    25883300         14.29
2009-05-29     15.19     15.84    15.11      15.84    29557500         15.84
2009-06-30     15.85     15.90    15.35      15.66    16033900         15.66
2009-07-31     14.72     14.89    14.29      14.32    62659900         14.32
2009-08-31     14.74     14.80    14.56      14.61    15420500         14.61
2009-09-30     17.48     17.94    17.24      17.81    39878200         17.81
2009-10-30     16.06     16.37    15.80      15.90    22321700         15.90
2009-11-30     14.90     15.10    14.80      14.97    17587000         14.97
2009-12-31     16.92     16.96    16.77      16.78     9515600         16.78
2010-01-29     15.51     15.67    14.90      15.01    39664600         15.01
2010-02-26     15.27     15.41    15.16      15.31    14975600         15.31
2010-03-31     16.45     16.58    16.42      16.53    11996900         16.53
2010-04-30     17.11     17.13    16.53      16.53    19688200         16.53
2010-05-28     15.61     15.69    15.00      15.34    17619700         15.34
2010-06-30     13.95     14.22    13.79      13.84    23912900         13.84
2010-07-30     13.69     13.98    13.68      13.88    18380400         13.88
2010-08-31     13.11     13.14    12.94      13.11    16489500         13.11
2010-09-30     14.26     14.35    13.99      14.17    20376200         14.17
2010-10-29     16.37     16.52    16.33      16.49    16013700         16.49
2010-11-30     16.20     16.34    15.77      15.82    24981100         15.82
2010-12-31     16.74     16.76    16.47      16.63     7754500         16.63
2011-01-31     15.82     16.20    15.79      16.12    22911400         16.12
2011-02-28     16.37     16.60    16.28      16.40    20210300         16.40
2011-03-31     16.71     16.88    16.65      16.68    15131500         16.68
2011-04-29     17.46     17.77    17.36      17.70    30800000         17.70
2011-05-31     16.17     16.59    16.12      16.55    30266600         16.55
2011-06-30     14.98     15.10    14.64      15.04    34905700         15.04
2011-07-29     13.89     14.07    13.04      13.10    67798500         13.10
2011-08-31     13.91     13.94    13.54      13.61    25390700         13.61
2011-09-30     13.21     13.44    13.11      13.17    30232800         13.17
2011-10-31     16.06     16.07    15.45      15.64    39763700         15.64
2011-11-30     15.90     16.04    15.65      15.71    34718200         15.71
2011-12-30     16.18     16.21    16.03      16.13    10832800         16.13
2012-01-31     15.54     15.62    15.41      15.47    10725500         15.47
2012-02-29     14.89     14.93    14.78      14.83    19611100         14.83
2012-03-30     15.37     15.42    15.18      15.22    15514100         15.22
2012-04-30     15.55     15.57    15.45      15.54    10894600         15.54
2012-05-31     15.23     15.37    15.12      15.24    17160000         15.24
2012-06-29     15.61     15.83    15.53      15.83    13501800         15.83
2012-07-31     16.00     16.06    15.81      15.84    13753800         15.84
2012-08-31     14.79     14.82    14.59      14.65    11619700         14.65
2012-09-28     16.01     16.09    15.93      15.98    19744300         15.98
2012-10-31     16.81     16.89    16.60      16.84    21058800         16.84
2012-11-30     18.90     18.95    18.69      18.77    24075300         18.77
2012-12-31     19.43     19.97    19.40      19.90    20645100         19.90

```

### 2.5 其它常用函数

#### 2.5.1 峰值、峰谷函数

* findPeaks(x, thresh=0)：找峰值
* findValleys(x, thresh=0)：找谷底值

```{r}
## 返回峰值对应的序号
> head(findPeaks(Op(YHOO)))
[1]  6 10 17 22 24 28

> head(findValleys(Op(YHOO)))
[1]  3  7 15 20 23 25
```
#### 2.5.2 series族函数

* seriesHi(x)：提取一段时序的最高价
* seriesLo(x):提取一段时序的最低价

```{r}
> seriesHi(Op(YHOO))
           YHOO.Open
2014-11-05     47.62
> seriesLo(Op(YHOO))
           YHOO.Open
2008-11-20       9.1
```

#### 2.5.3 涨跌判断函数

* seriesIncr(x, thresh=0, diff.=1L)：上涨
* seriesDecr(x, thresh=0, diff.=1L)：下跌
* endpoints()：寻找节点

``` r
> head(seriesIncr(Op(YHOO)))
           YHOO.Open
2007-01-03        NA
2007-01-04     FALSE
2007-01-05      TRUE
2007-01-08      TRUE
2007-01-09      TRUE
2007-01-10     FALSE
> head(seriesDecr(Op(YHOO)))
           YHOO.Open
2007-01-03        NA
2007-01-04      TRUE
2007-01-05     FALSE
2007-01-08     FALSE
2007-01-09     FALSE
2007-01-10      TRUE
```

